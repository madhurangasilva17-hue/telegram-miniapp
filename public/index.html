<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{
margin:0;
font-family:system-ui;
background:#f3f6fb;
color:#111;
}

.container{
max-width:500px;
margin:auto;
padding:16px;
}

.card{
background:white;
border-radius:16px;
padding:16px;
margin-bottom:14px;
box-shadow:0 8px 20px rgba(0,0,0,.05);
}

h2{margin:0 0 4px}

.balance{
font-size:26px;
font-weight:800;
color:#1e88e5;
}

.btn{
width:100%;
padding:14px;
border:none;
border-radius:12px;
font-weight:700;
background:#1e88e5;
color:white;
margin-top:10px;
}

.ref{
font-size:13px;
word-break:break-all;
color:#555;
}
</style>
</head>

<body>
<div class="container">

<div class="card">
<h2 id="name">Loading...</h2>
<div>Balance</div>
<div class="balance"><span id="bal">0</span> LKR</div>
</div>

<div class="card">
<b>Your Referral Link</b>
<div class="ref" id="link"></div>
<button class="btn" onclick="copy()">Copy Link</button>
</div>

</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const BOT = "easycashsrilanka_bot";

const user = tg.initDataUnsafe.user;

async function load(){
if(!user){
document.getElementById("name").innerText="Open inside Telegram";
return;
}

await fetch("/ensure-user",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({id:String(user.id),name:user.first_name})
});

const res = await fetch("/user/"+user.id);
const data = await res.json();

document.getElementById("name").innerText=data.name;
document.getElementById("bal").innerText=data.balance;

const link=`https://t.me/${BOT}?start=${data.code}`;
document.getElementById("link").innerText=link;
}

function copy(){
navigator.clipboard.writeText(document.getElementById("link").innerText);
tg.showAlert("Copied!");
}

load();
</script>
</body>
</html>
